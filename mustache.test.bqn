
âŸ¨CompileâŸ© â† â€¢Import "./mustache.bqn"

# TODO trim all lines instead of remove all whitespace
Trimâ†{ (<ğ•©) { (>ğ•©)/ËœÂ¬(>ğ•©)=ğ•¨ }Â´ âŸ¨@+10,' 'âŸ© }
Test â† {
  ğ•Š n:
    âŸ¨dataâŸ©â†â€¢Import "fixtures/"âˆ¾ ğ•© âˆ¾ ".bqn"
    srcâ†Trim â€¢file.Chars "fixtures/" âˆ¾ ğ•© âˆ¾ ".mustache"
    expâ†Trim â€¢file.Chars "fixtures/" âˆ¾ ğ•© âˆ¾ ".expected"
    actâ†Trim src Compile data

    Msg â† {ğ•Š: 
      â€¢Out "Ã— Failed " âˆ¾ n âˆ¾ ""
      â€¢Out "Expected: "
      â€¢Out "    " âˆ¾ exp  
      â€¢Out "Actual:" 
      â€¢Out "    " âˆ¾ act
      â€¢Out " "
    }
    !âˆ˜MsgâŸ(1âŠ¸â‰¢) expâ‰¡act

    â€¢Out "âœ“ " âˆ¾ ğ•©
}

â€¢Out "=== Testing ==="

extâ†".expected"â€¿".bqn"â€¿".mustache"
f â† â€¢file.List "fixtures/"
nâ†{ğ•©/ËœÂ¬0=âŒ½+`âŒ½Â«ğ•©='.'}Â¨f
vâ†{âˆ§Â´extâˆŠğ•©}Â¨(âŠn)âŠ”{ğ•©/Ëœ0=âŒ½+`âŒ½Â«ğ•©='.'}Â¨f # valid suites where all ext exists
sâ†âˆ§nâŠËœâŠ‘Â¨v/âŠ”âŠn 
Test Â¨{0â‰ â‰ ğ•©}â—¶âŸ¨s, {s/ËœsâˆŠğ•©}âŸ© â€¢args
â€¢Out "  ok all done"

#! "<a>123</a>" â‰¡ "<a>{{foo}}</a>" Compile {fooâ‡123}

