
âŸ¨CompileâŸ© â† â€¢Import "./mustache.bqn"

â€¢Out "=== Testing ==="

extâ†".expected"â€¿".bqn"â€¿".mustache"
f â† â€¢file.List "fixtures/"
nâ†{ğ•©/ËœÂ¬0=âŒ½+`âŒ½Â«ğ•©='.'}Â¨f
vâ†{âˆ§Â´extâˆŠğ•©}Â¨(âŠn)âŠ”{ğ•©/Ëœ0=âŒ½+`âŒ½Â«ğ•©='.'}Â¨f # valid suites where all ext exists

# TODO trim all lines instead of remove all whitespace
Trimâ†{ (<ğ•©) { (>ğ•©)/ËœÂ¬(>ğ•©)=ğ•¨ }Â´ âŸ¨@+10,' 'âŸ© }

{
  ğ•Š n:
    âŸ¨dataâŸ©â†â€¢Import "fixtures/"âˆ¾ ğ•© âˆ¾ ".bqn"
    srcâ†Trim â€¢file.Chars "fixtures/" âˆ¾ ğ•© âˆ¾ ".mustache"
    expâ†Trim â€¢file.Chars "fixtures/" âˆ¾ ğ•© âˆ¾ ".expected"
    actâ†Trim src Compile data

    Msg â† {ğ•Š: 
      â€¢Out "Ã— Failed " âˆ¾ n âˆ¾ ""
      â€¢Out "Expected: "
      â€¢Out "    " âˆ¾ exp  
      â€¢Out "Actual:" 
      â€¢Out "    " âˆ¾ act
      â€¢Out " "
    }
    !âˆ˜MsgâŸ(1âŠ¸â‰¢) expâ‰¡act
}Â¨nâŠËœâŠ‘Â¨v/âŠ”âŠn #

â€¢Out "âœ“ ok all done"


#! "<a>123</a>" â‰¡ "<a>{{foo}}</a>" Compile {fooâ‡123}

#! "<a><b>1 2</b><b>3 4</b></a>" â‰¡"<a>{{#x}}<b>{{y}} {{z}}</b>{{/x}}</a>" Compile {xâ‡âŸ¨{yâ‡1â‹„zâ‡2},{yâ‡3â‹„zâ‡4}âŸ©}
#! "<a><b>1 2</b><b>3 4</b></a>" â‰¡"<a>{{#x}}<b>{{y}} {{z}}</b>{{/x}}</a>" Compile {xâ‡âŸ¨{zâ‡2â‹„yâ‡1},{zâ‡4â‹„yâ‡3}âŸ©} # reversed children namespace keys
#! "<a><b><c>1</c></b><b><c>2</c></b></a>" â‰¡"<a>{{#x}}<b>{{#y}}<c>{{z}}</c>{{/y}}</b>{{/x}}</a>" Compile {xâ‡âŸ¨{yâ‡{zâ‡1}}â‹„{yâ‡{zâ‡2}}âŸ©}
#! "<a><b><c>1</c><c>2</c></b></a>" â‰¡"<a>{{#x}}<b>{{#y}}<c>{{z}}</c>{{/y}}</b>{{/x}}</a>" Compile {xâ‡âŸ¨{yâ‡âŸ¨{zâ‡1},{zâ‡2}âŸ©}âŸ©}


#â€¢Out "âœ“ ok all done"
