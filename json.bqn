# parser for relaxed version of json to be used as input for mustache.bqn
# - keys and values do not need quotes
# - all values are strings
# - trailing commas are allowed

Parent â† { gâ†âŠ”Â¯1âŒ½ğ•© â‹„ (â†•â‰ ğ•©) {aâ€¿wâ†ğ•¨ â‹„ (âŠâŸœa 1-Ëœaâ‹w)âŒ¾(wâŠ¸âŠ) ğ•© }Â´ (1â†“(Â»g){ğ•¨â€¿ğ•©}Â¨g) }
Delete â† { (/ğ•¨)(âŠ¢-â‹)(Â¬ğ•¨)/ğ•© } # delete from parent vector
#Parent â† { (â†•â‰ ğ•©) â‹„ â€¢Show Â¯1âŒ½ğ•© }
exâ†"
{
  foo: {
    bar: [{x: 1, y: 2}, {x:3, y:3}],
    baz: {w: 8, z: 9}
  }
}
"
ty â† { 
  noneâ‡0â‹„strâ‡1â‹„keyâ‡2â‹„valâ‡3â‹„colâ‡4â‹„curlyâ‡5â‹„angleâ‡6â‹„comâ‡7
}

{
   # t: types, r:references, n: names
   ch â† ğ•© â‹„ t â† @ â‹„ râ†@ â‹„ n â† @, p â† @
   # remove whitespace
   { ch (Â¬châˆŠ(@+10)â€¿' ')âŠ¸/â†© }
   # tokenize types
   { tâ†©âˆ¨Â´âŸ¨ty.strÃ—châˆŠâˆ¾"0aA"+âŸœâ†•Â¨10â€¿26â€¿26,ty.curlyÃ—châˆŠ"{}", ty.angleÃ—châˆŠ"[]", ty.colÃ—ch=':',ty.comÃ—ch=','âŸ©}
   # tokenize strings into reference and name vectors
   { mâ†t=ty.str â‹„ fâ† Â»âŠ¸< m â‹„ iâ†mÃ—+`f â‹„ z â†fâˆ¨tâ‰ ty.str â‹„ n â†© âŠâŸœchÂ¨âŠ”1-Ëœi â‹„ ch zâŠ¸/â†© â‹„ t zâŠ¸/â†© â‹„ r â†© 1-Ëœz/fÃ—i }
   # tokenize strings into reference and name vectors
   { mâ†t=ty.str â‹„ fâ† Â»âŠ¸< m â‹„ iâ†mÃ—+`f â‹„ z â†fâˆ¨tâ‰ ty.str â‹„ n â†© âŠâŸœchÂ¨âŠ”1-Ëœi â‹„ ch zâŠ¸/â†© â‹„ t zâŠ¸/â†©  â‹„ r â†© 1-Ëœz/fÃ—i }
   # tokenize keys
   { colâ†(t=ty.col) â‹„ strâ†(t=ty.str) â‹„ m â† strâˆ§Â«col â‹„ zâ†Â¬col â‹„ tâ†©z/ty.keyÂ¨âŒ¾(mâŠ¸/)t â‹„ ch zâŠ¸/â†© â‹„ r zâŠ¸/â†© }
   # TODO remove commas now that we have typed nodes
   [ch,t,r]

   # init parent
   #{ pâ†©â†•â‰ t }

   # TODO parent: arrays
   # TODO parent: brackets
  
} ex
