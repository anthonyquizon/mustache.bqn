# parser for relaxed version of json to be used as input for mustache.bqn
# - keys and values do not need quotes
# - all values are strings
# - trailing commas are allowed

Parent â† { gâ†âŠ”Â¯1âŒ½ğ•© â‹„ (â†•â‰ ğ•©) {aâ€¿wâ†ğ•¨ â‹„ (âŠâŸœa 1-Ëœaâ‹w)âŒ¾(wâŠ¸âŠ) ğ•© }Â´ (1â†“(Â»g){ğ•¨â€¿ğ•©}Â¨g) }
Delete â† { (/ğ•¨)(âŠ¢-â‹)(Â¬ğ•¨)/ğ•© } # delete from parent vector
#Parent â† { (â†•â‰ ğ•©) â‹„ â€¢Show Â¯1âŒ½ğ•© }
exâ†"
{
  foo: {
    bar: [{x: 1, y: 2}, {x:3, y:3}],
    baz: {w: 8, z: 9}
  }
}
"

type â† { 
  noneâ‡0 â‹„ strâ‡1 â‹„ keyâ‡2 â‹„ valâ‡3 â‹„ colâ‡4 â‹„  comâ‡5
  curly_opnâ‡6 â‹„ sqr_opnâ‡7 â‹„ curly_clsâ‡8 â‹„ sqr_clsâ‡9
}

{
   # t: typepes, r:references, n: names
   ch â† ğ•© â‹„ t â† @ â‹„ râ†@ â‹„ n â† @ â‹„ p â† @
   # remove whitespace
   { ch (Â¬châˆŠ(@+10)â€¿' ')âŠ¸/â†© }
   # tokenize: types
   { 
    tâ†©âˆ¨Â´type.curly_opnâ€¿type.curly_clsâ€¿type.sqr_opnâ€¿type.sqr_clsâ€¿type.colâ€¿type.com Ã—châŠ¸=Â¨"{}[]:," 
    tâ†©tâˆ¨(type.strÃ—châˆŠâˆ¾"0aA"+âŸœâ†•Â¨10â€¿26â€¿26)
   }
   # tokenize: strings into reference and name vectors
   { mâ†t=type.str â‹„ fâ† Â»âŠ¸< m â‹„ iâ†mÃ—+`f â‹„ z â†fâˆ¨tâ‰ type.str â‹„ n â†© âŠâŸœchÂ¨âŠ”1-Ëœi â‹„ ch zâŠ¸/â†© â‹„ t zâŠ¸/â†© â‹„ r â†© 1-Ëœz/fÃ—i }
   # tokenize: keys
   { colâ†t=type.col â‹„ strâ†t=type.str â‹„ m â† strâˆ§Â«col â‹„ zâ†Â¬col â‹„ tâ†©z/type.keyÂ¨âŒ¾(mâŠ¸/)t â‹„ ch zâŠ¸/â†© â‹„ r zâŠ¸/â†© }
   # tokenize: remove commas (not needed now that we have index names)
   { zâ†tâ‰ type.com â‹„ t zâŠ¸/â†© â‹„ ch zâŠ¸/â†© â‹„ r zâŠ¸/â†© }
   # ch no longer needed after tokenized process
   # init parent
   { pâ†©â†•â‰ t }
   
   # tokenize arrays
   #{ oâ†t=type.sqr_opnâ‹„câ†t=type.sqr_cls 
     #iâ†oÃ—â†•â‰ ch
    #â€¢Show +`o-c
   #}
   # TODO remove commas now that we have typeped nodes

   â€¢Show [p,r]

   # TODO parent: arrays
   # TODO parent: brackets
  
} ex
