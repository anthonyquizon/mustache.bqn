
# delete leaf nodes - match to parent tree

âŸ¨DrawâŸ© â† â€¢Import "tree.bqn" 
Parent â‡ { gâ†âŠ”ğ•© â‹„ (â†•â‰ ğ•©) {aâ€¿wâ†ğ•¨ â‹„ (âŠâŸœa 1-Ëœaâ‹w)âŒ¾(wâŠ¸âŠ) ğ•© }Â´ (1â†“(Â»g){ğ•¨â€¿ğ•©}Â¨g) }
mustache â† â€¢Import "mustache.bqn" 

##p â† 0â€¿0â€¿1â€¿1â€¿1â€¿5â€¿5â€¿6â€¿6
##p â† 0â€¿0â€¿1â€¿1
##p â† 0â€¿0â€¿1â€¿1â€¿1â€¿5â€¿5â€¿6â€¿6â€¿0â€¿9â€¿9â€¿10


##a â† {
  ##eachâ‡âŸ¨
    ##{fooâ‡111, barâ‡222}
    ##{fooâ‡333, barâ‡444},
  ##âŸ©,
  ##peachâ‡âŸ¨
    ##{fooâ‡111, quuxâ‡222}
    ##{fooâ‡333, quuxâ‡444},
  ##âŸ©
##}

a â† {
  eachâ‡âŸ¨
    {fooâ‡111, barâ‡222}
  âŸ©,
}


#âŸ¨none, str, obj, arr, key, valâŸ© â† â†•6
## 0 0 0 0 1 1 1 3 3 3
## 1 1 1 1 1 1 1 2 2 2
## e a c h f o o

#ParseNs â† {
    #ğ•Š ğ•© : 0 ğ•Š ğ•©;
  #d ğ•Š ns : 6â‰¡â€¢Type ns ? 
    #â€¢Show kâ†â€¢ns.Keys ns
    #sâ†' 'âˆ¾âˆ¾k
    #tâ†objâˆ¾âˆ¾k
    #{(d+1) ParseNs ns â€¢ns.Get ğ•©}Â¨k
    #â€¢Show [s,t]

    ##sâ†â€¢ns.Keys ns
    ## TODO add refs
    ##{sâ‡sâˆ¾c.s }
    #âŸ¨âŸ©
    #;

  #d ğ•Š ğ•© : 2â‰¡â€¢Type ğ•© ? [[d],[val],[ğ•©]] ;
  #d ğ•Š ğ•© : 0â‰¡â€¢Type ğ•© ? 
    #â€¢Show â‰¢â‰>(d+1)âŠ¸ParseNsÂ¨ğ•©
    #âŸ¨âŸ©
    #;

  #d ğ•Š ğ•© : d ğ•Š â€¢Fmt ğ•©

  ##d ğ•Š s : (0â‰¡â€¢Type ğ•©) ? { sâ‡âŸ¨sâŸ©, dâ‡âŸ¨dâŸ©, tâ‡âŸ¨'v'âŸ©, râ‡âŸ¨0âŸ© } ; # parse string
  ##d ğ•Š a : 0â‰¡â€¢Type ğ•© ? 
    ##c â†{(d+1) ParseNs ğ•©} Â¨ a
    ##{ sâ‡{ğ•©.s}Â¨c, dâ‡âŸ¨dâŸ©âˆ¾{ğ•©.d}Â¨c, tâ‡âŸ¨'a'âŸ©âˆ¾{ğ•©.s}Â¨c, râ‡âŸ¨Â¯1âŸ©âˆ¾{ğ•©.s}Â¨c }
    ##â€¢Show "list"
    ##â€¢SHow 1
  ##;
  ##d ğ•Š n : 1â‰¡â€¢Type ğ•© ? d ğ•Š â€¢Fmt ğ•©
#}


# parse namespaces and to parent tree
ParseNs â† {
     ğ•Š ğ•© :  
       âŸ¨s,d,tâŸ© â† 0 ğ•Š ğ•© 
       mâ†0âŠ¸=âˆ˜â‰ Â¨s â‹„ pâ†(Parent d) â‹„ râ†(â†•(â‰ s)-(â‰ /m))âŒ¾((Â¬m)âŠ¸/) (â‰ s)â¥ŠÂ¯1 â‹„ nâ† sâ†©(Â¬m)/s
       {ptrâ‡[p,t,r], nâ‡n}
  ;d ğ•Š ns : 6â‰¡â€¢Type ns ? 
    childrenâ†âˆ¾Â¨Â´{ âŸ¨âŸ¨ğ•©âŸ©, (d+1), âŸ¨'k'âŸ©âŸ© âˆ¾Â¨ (d+2) ParseNs (ns â€¢ns.Get ğ•©) } Â¨â€¢ns.Keys ns
    âŸ¨âŸ¨""âŸ©, âŸ¨dâŸ©, âŸ¨'o'âŸ©âŸ© âˆ¾Â¨ children 
  ;d ğ•Š ğ•© : 0â‰¡â€¢Type ğ•© ? 
    { ğ•Š s : âˆ§Â´2âŠ¸â‰¡âˆ˜â€¢TypeÂ¨s ? âŸ¨âŸ¨sâŸ©, âŸ¨dâŸ©, âŸ¨'v'âŸ©âŸ© ; # parse string
      ğ•Š ğ•© : âˆ¾Â¨Â´{ (d) ParseNs ğ•©}Â¨ğ•© 
    } ğ•©
  ;ğ•¨ ğ•Š ğ•© : 1â‰¡â€¢Type ğ•© ? ğ•¨ ğ•Š â€¢Fmt ğ•©
}

data â† ParseNs a

tpl â† data mustache.Parse (â€¢file.Chars "test.mustache")

[p,t,r]â†tpl.ptr
##â€¢Show tpl.names
t Draw p

##tpl mustache.Compile data

